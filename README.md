# OpenCitations Meta Software

OpenCitations Meta will contain bibliographic metadata associated with the documents involved in the citations stored in the [OpenCitations](https://opencitations.net/) infrastructure. The OpenCitations Meta Software performs two main actions, a data curation of the CSV files that are provided and the generation of new RDF files compliant with the [OpenCitations Data Model](http://opencitations.net/model).

An example of a raw CSV input file can be found in [`example.csv`](https://github.com/opencitations/meta/blob/master/example.csv).

The software is launched through the [`run_process.py`](https://github.com/opencitations/meta/blob/master/run_process.py) file via the prompt command:
```console
    python -m meta.run_process -c <PATH> -v <PATH> -i <PATH> -a <PATH> -s <PATH> -v
```
Where:
- -c --crossref : directory where raw CSV files are stored.
- -o --output: directory where cleaned CSVs will be stored.
- -i --ind: directory where cleaned indices will be stored (indices are products of CSV cleaning step, necessary for RDFs creation).
- -a --aux: path of txt file containing processed CSV list.
- -s --src: data source URL, not mandatory.
- -v --verbose: show a loading bar, elapsed time and estimated time, not mandatory.

So far, preprocessing functions dedicated to the management of data coming from [Crossref](https://www.crossref.org/) have also been implemented. As preprocessing these functions must be performed before running [`run_process.py`](https://github.com/opencitations/meta/blob/master/run_process.py). In particular this pre-processing is dedicated to the bibliographical metadata of the publications involved in the citations stored in [COCI](http://opencitations.net/index/coci), the OpenCitations Index of Crossref open DOI-to-DOI citations.

The preliminary step, [`index_orcid_doi.py`](https://github.com/opencitations/meta/blob/master/orcid/index_orcid_doi.py), inside [`orcid`](https://github.com/opencitations/meta/blob/master/orcid) package, generates an index between the author's ORCID and publication's in CSV format using Orcid Summaries Dump (e.g. [ORCID_2019_summaries](https://orcid.figshare.com/articles/ORCID_Public_Data_File_2019/9988322)):
```console
    python -m meta.orcid.index_orcid_doi -c <PATH> -s <PATH> -v
```
Where:
- -c --csv: a directory where the output CSV files will be store, that is, the ORCID-DOI index.
- -s --summaries: ORCID summaries dump path, subfolder will be considered too.
- -t --threshold: threshold after which to update the output, not mandatory. A new file will be generated each time.
- -v --verbose: show a loading bar, elapsed time and estimated time, not mandatory.

Pre-prochessing function generates raw CSV files using JSON files from Crosseref data dump (e.g. [Crossref Works Dump - August 2019](https://figshare.com/articles/Crossref_Works_Dump_-_August_2019/9751865)), enriching them with ORCID IDs from ORCID-DOI Index generated in previous step.
This function is launched through the [`run_preprocess.py`](https://github.com/opencitations/meta/blob/master/run_preprocess.py) file via the prompt command:
```console
    python -m meta.run_preprocess -c <PATH> -o <PATH> -v <PATH> -w <PATH> -v
```
Where:
- -c --crossref: Crossref JSON files directory (input files).
- -o --orcid: ORCID-DOI index filepath, generated by [`index_orcid_doi.py`](https://github.com/opencitations/meta/blob/master/orcid/index_orcid_doi.py).
- -v --csv: directory where CSVs will be stored.
- -w --wanted: path of a CSV file containing what DOI to process, not mandatory.     
- -v --verbose: show a loading bar, elapsed time and estimated time, not mandatory.

## Plugins

### Get DOIs from COCI dump

You can get a CSV file containing all the DOIs from the [COCI's dump](https://opencitations.net/download). This CSV file can be passed as an input to the `-wanted` argument of [`run_preprocess.py`](https://github.com/opencitations/meta/blob/master/run_preprocess.py). You can obtain this file by using the [`get_dois_from_coci.py`](https://github.com/opencitations/meta/blob/master/coci/get_dois_from_coci.py) script, in the following way:
```console
    python -m meta.coci.get_dois_from_coci -c <PATH> -o <PATH> -v
```
Where:
- -c --coci: COCI's dump path.
- -o --output: path of the output CSV file.
- -v --verbose: show a loading bar, elapsed time and estimated time, not mandatory.

